# The `FROM` instruction specifies the base image. You are
# extending the `microsoft/aspnet` image.

FROM microsoft/aspnet:4.6.2

#Download status monitor
ADD http://go.microsoft.com/fwlink/?LinkID=522371&clcid=0x409 ApplicationInsightsAgent.msi

#Check status of msiserver
RUN powershell -NoProfile -Command \
	get-service -name msiserver;

#Check status of SM install
RUN powershell -NoProfile -Command \	
	Get-ItemProperty 'hklm:\\SYSTEM\\CurrentControlSet\\Services\\W3SVC'
	
#Install status monitor
RUN msiexec /i ApplicationInsightsAgent.msi /qn /LIME .\sminstall.txt
RUN powershell -NoProfile -Command \	
	Write-Host "installation logs" \
	Get-Content .\sminstall.txt | Write-Host

#Restart iis to take status monitor effect
RUN iisreset /restart

#Check status of SM install
RUN powershell -NoProfile -Command \	
	Get-ItemProperty 'hklm:\\SYSTEM\\CurrentControlSet\\Services\\W3SVC'


COPY . /inetpub/wwwroot	